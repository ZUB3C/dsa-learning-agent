# ───────────────────────────────────────────────────────────────
# PROJECT SETTINGS
# ───────────────────────────────────────────────────────────────

PROJECT_NAME="DSA Leaning Agent v2"
VERSION=2.0.0
ENVIRONMENT=development
DEBUG=true

# ───────────────────────────────────────────────────────────────
# LLM SETTINGS - GIGACHAT
# ───────────────────────────────────────────────────────────────

# GigaChat API Key (required)
GIGACHAT_API_KEY=your_gigachat_api_key

# GigaChat Base URL
GIGACHAT_BASE_URL=https://foundation-models.api.cloud.ru/v1

# GigaChat-2-Max (для thought generation - дорогой)
GIGACHAT_MAX_MODEL=GigaChat/GigaChat-2-Max
GIGACHAT_MAX_TEMPERATURE=0.3
GIGACHAT_MAX_TIMEOUT_S=30.0

# GigaChat3 (для evaluation и tools - дешевый)
GIGACHAT3_MODEL=ai-sage/GigaChat3-10B-A1.8B
GIGACHAT3_TEMPERATURE=0.2
GIGACHAT3_TIMEOUT_S=10.0

# Legacy settings (для обратной совместимости)
GIGACHAT_MODEL=GigaChat/GigaChat-2-Max
LLM_TEMPERATURE=0.2
TIMEOUT_S=60

# ───────────────────────────────────────────────────────────────
# DATABASE
# ───────────────────────────────────────────────────────────────

# SQLite (default)
DATABASE_URL=sqlite+aiosqlite:///./app_data.db
DATABASE_ECHO=true

# PostgreSQL (optional, for production)
# DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/materials_agent

# ───────────────────────────────────────────────────────────────
# CHROMADB - VECTOR STORE
# ───────────────────────────────────────────────────────────────

# ChromaDB persistence directory
CHROMA_PERSIST_DIRECTORY=./data/chroma

# Collection names
CHROMA_COLLECTION_NAME=aisd_materials
CHROMA_WORKING_MEMORY_COLLECTION=agent_working_memory
CHROMA_PROCEDURAL_MEMORY_COLLECTION=agent_procedural_memory

# Embedding settings
SEMANTIC_EMBEDDING_MODEL=sentence-transformers/paraphrase-multilingual-mpnet-base-v2

# Document chunking
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
PDF_CHUNK_SIZE=1000
PDF_CHUNK_OVERLAP=200

# ───────────────────────────────────────────────────────────────
# RAG SETTINGS
# ───────────────────────────────────────────────────────────────

# Basic RAG
RAG_TOP_K=5
RAG_MIN_SIMILARITY=0.6

# Adaptive RAG
ADAPTIVE_RAG_ENABLED=true
ADAPTIVE_SIMPLE_THRESHOLD=50
ADAPTIVE_COMPLEX_THRESHOLD=200
RRF_K_CONSTANT=60

# Corrective RAG
CORRECTIVE_RAG_ENABLED=true
CORRECTIVE_MIN_RELEVANCE=0.6
CORRECTIVE_MIN_DOCS_AFTER_FILTER=2
CORRECTIVE_BATCH_SIZE=10
CORRECTIVE_TIMEOUT_S=10.0

# ───────────────────────────────────────────────────────────────
# WEB SEARCH - 4GET META-SEARCH
# ───────────────────────────────────────────────────────────────

# Web search toggle
WEB_SEARCH_ENABLED=true

# 4get instances
WEB_SEARCH_PROVIDER=4get
WEB_SEARCH_BASE_URL=https://4get.bloat.cat
WEB_SEARCH_SCRAPER=Google
WEB_SEARCH_FALLBACK_URLS=["https://4get.lunar.icu"]
WEB_SEARCH_FALLBACK_SCRAPERS=["Yandex","Google","DuckDuckGo"]

# Search parameters
WEB_SEARCH_RESULTS_LIMIT=5
WEB_SEARCH_TIMEOUT_S=10.0
WEB_SEARCH_ADD_CONTEXT=true
WEB_SEARCH_CONTEXT_SUFFIX="алгоритмы и структуры данных обучение"

# Domain filtering
WEB_SEARCH_BLACKLIST=[]
WEB_SEARCH_PRIORITY_EDU=2.0
WEB_SEARCH_PRIORITY_ORG=1.5
WEB_SEARCH_PRIORITY_GOV=1.8
WEB_SEARCH_PRIORITY_WIKI=1.9
WEB_SEARCH_PRIORITY_HABR=1.7
WEB_SEARCH_PRIORITY_STACKOVERFLOW=1.8
WEB_SEARCH_PRIORITY_COM=1.0
WEB_SEARCH_PRIORITY_RU=2.5

# Deduplication
WEB_SEARCH_DEDUPLICATE_THRESHOLD=0.8

# ───────────────────────────────────────────────────────────────
# WEB SCRAPER - CONTENT FETCHING
# ───────────────────────────────────────────────────────────────

WEB_CONTENT_FETCH_ENABLED=true
WEB_CONTENT_TIMEOUT_S=5.0
WEB_CONTENT_EXTENDED_TIMEOUT_S=10.0
WEB_CONTENT_MAX_LENGTH=5000
WEB_CONTENT_BATCH_SIZE=5

# User-Agent rotation (comma-separated)
WEB_CONTENT_USER_AGENTS=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"]

# Content extraction selectors - JSON array format
WEB_CONTENT_SELECTORS=["article","main",".content",".post-content","#content"]

# Tags to remove - JSON array format
WEB_CONTENT_REMOVE_TAGS=["script","style","nav","footer","header","aside","iframe"]

# ───────────────────────────────────────────────────────────────
# CONCEPT EXTRACTION
# ───────────────────────────────────────────────────────────────

# KeyBERT settings
CONCEPT_KEYBERT_ENABLED=true
CONCEPT_KEYBERT_MODEL=paraphrase-multilingual-MiniLM-L12-v2
CONCEPT_KEYBERT_TOP_N=10

# spaCy settings
CONCEPT_SPACY_ENABLED=false
CONCEPT_SPACY_MODEL=ru_core_news_sm
CONCEPT_SPACY_ENTITY_TYPES=["PERSON","ORG","GPE","NORP","FAC","LOC"]

# Fuzzy matching threshold
CONCEPT_FUZZY_THRESHOLD=0.85

# ───────────────────────────────────────────────────────────────
# TREE-OF-THOUGHTS (ToT) SETTINGS
# ───────────────────────────────────────────────────────────────

# ToT orchestration
TOT_ENABLED=true
TOT_MAX_DEPTH=6
TOT_BRANCHING_FACTOR=3
TOT_COMPLETENESS_THRESHOLD=0.85
TOT_PROMISE_THRESHOLD=0.5

# Dead-end detection
TOT_DEAD_END_RELEVANCE=0.3
TOT_DEAD_END_QUALITY=0.4

# ───────────────────────────────────────────────────────────────
# CONTENT GUARD SETTINGS
# ───────────────────────────────────────────────────────────────

# Content Guard toggle
CONTENT_GUARD_ENABLED=true

# Toxicity check
TOXICITY_CHECK_ENABLED=true
TOXICITY_THRESHOLD=0.7
TOXICITY_BATCH_SIZE=10
TOXICITY_TIMEOUT_S=10.0

# Policy compliance
POLICY_CHECK_ENABLED=true
POLICY_CHECK_TIMEOUT_S=5.0

# Content sanitization
SANITIZE_REMOVE_URLS=false
SANITIZE_REMOVE_EMAILS=true
SANITIZE_MAX_LENGTH_PER_DOC=5000

# Quality gate
MIN_CONTENT_LENGTH=50
MAX_CONTENT_LENGTH=10000
MIN_SENTENCE_COUNT=3

# ───────────────────────────────────────────────────────────────
# MEMORY SYSTEM
# ───────────────────────────────────────────────────────────────

# Working memory (short-term)
MEMORY_WORKING_ENABLED=true
MEMORY_WORKING_TTL_HOURS=24

# Procedural memory (long-term patterns)
MEMORY_PROCEDURAL_ENABLED=true
MEMORY_PROCEDURAL_MAX_PATTERNS=1000
MEMORY_PROCEDURAL_MIN_SUCCESS_SCORE=0.8

# ───────────────────────────────────────────────────────────────
# INPUT VALIDATION
# ───────────────────────────────────────────────────────────────

VALIDATION_ENABLED=true
VALIDATION_MIN_INPUT_LENGTH=5
VALIDATION_MAX_INPUT_LENGTH=1000
VALIDATION_TIMEOUT_S=5.0

# ───────────────────────────────────────────────────────────────
# CACHING (Redis)
# ───────────────────────────────────────────────────────────────

CACHE_ENABLED=true
REDIS_URL=redis://localhost:6379
CACHE_TTL_SECONDS=3600
CACHE_GENERATION_RESULTS=true
CACHE_RAG_QUERIES=true

# ───────────────────────────────────────────────────────────────
# API SETTINGS
# ───────────────────────────────────────────────────────────────

# Server
API_HOST=0.0.0.0
API_PORT=8001
API_WORKERS=4
API_TIMEOUT_S=300

# CORS
CORS_ENABLED=true
CORS_ORIGINS=["http://localhost:3000","http://localhost:8001"]
CORS_METHODS=["GET","POST","PUT","DELETE","OPTIONS"]
CORS_HEADERS=*

# Rate limiting
RATE_LIMIT_ENABLED=false
RATE_LIMIT_PER_MINUTE=60

SECRET_KEY=your_secret_key


# Debug features
# Include ToT best_path in responses
INCLUDE_DEBUG_INFO=true

# ───────────────────────────────────────────────────────────────
# FEATURE FLAGS
# ───────────────────────────────────────────────────────────────

# Core features
FEATURE_TOT_ENABLED=true
FEATURE_CONTENT_GUARD_ENABLED=true
FEATURE_ADAPTIVE_RAG_ENABLED=true
FEATURE_WEB_SEARCH_ENABLED=true
FEATURE_PROCEDURAL_MEMORY_ENABLED=true

# Experimental features
FEATURE_CONCEPT_EXTRACTION_ENABLED=true
FEATURE_MEMORY_RETRIEVAL_ENABLED=true

# ───────────────────────────────────────────────────────────────
# LOGGING
# ───────────────────────────────────────────────────────────────

LOG_LEVEL=DEBUG
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_FILE=./logs/materials_agent.log
LOG_ROTATION=1d
LOG_RETENTION=30d

# ───────────────────────────────────────────────────────────────
# MONITORING & METRICS
# ───────────────────────────────────────────────────────────────

METRICS_ENABLED=true
METRICS_PORT=9090


# ───────────────────────────────────────────────────────────────
# NOTES
# ───────────────────────────────────────────────────────────────

# 1. Replace GIGACHAT_API_KEY with your actual GigaChat API key
# 2. Replace OPENAI_API_KEY with your OpenAI key (for embeddings)
# 3. For production, use PostgreSQL instead of SQLite
# 4. Enable Redis caching for better performance
# 5. Adjust ToT parameters based on cost/quality tradeoff
# 6. Monitor estimated_cost_usd in responses to track spending
