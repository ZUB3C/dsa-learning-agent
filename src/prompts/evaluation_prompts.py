"""
Prompts for evaluation (promise, completeness, relevance).
"""

PROMISE_EVALUATION_PROMPT = """# Задача оценки перспективности

Оцени, насколько **перспективно** следующее действие для достижения цели.

# Контекст
- **Запрос пользователя**: {query}
- **Уже собрано документов**: {collected_so_far}
- **Предложенное действие**: {proposed_action}
- **Объяснение**: {reasoning}

# Критерии оценки
1. **Релевантность** (0-1): насколько действие соответствует запросу
2. **Новизна** (0-1): принесет ли новую информацию (не дубликаты)
3. **Эффективность** (0-1): стоимость/польза (RAG лучше веба для базовых тем)
4. **Прогресс** (0-1): приблизит ли к цели (completeness 0.85)

# Формат ответа (JSON)
{{
  "promise_score": 0.85,  // Итоговая оценка 0-1
  "reasoning": "Это действие перспективно, потому что...",
  "breakdown": {{
    "relevance": 0.9,
    "novelty": 0.8,
    "efficiency": 0.9,
    "progress": 0.8
  }}
}}

Ответ (только JSON):"""


POST_EXECUTION_EVALUATION_PROMPT = """Оцени результаты сбора информации для запроса пользователя.

# Контекст
Запрос: {query}
Собрано документов: {total_docs}
Последние документы:
{latest_docs_summary}

# Критерии оценки (0.0-1.0)

**Completeness** - достаточно ли информации:
- Если 0-2 документа → 0.2-0.4
- Если 3-5 документов и релевантны → 0.6-0.75
- Если 6-8 документов, есть теория + примеры → 0.8-0.85
- Если 9+ документов, полная теория + код + примеры → 0.9-1.0

**Relevance** - соответствие теме:
- 1.0 = все документы точно по теме
- 0.7-0.9 = большинство релевантны
- 0.4-0.6 = половина не по теме
- < 0.4 = почти все нерелевантны

**Quality** - качество документов:
- 0.8-1.0 = структурированные материалы с примерами
- 0.6-0.7 = читаемые тексты
- < 0.6 = фрагменты, плохая структура

**Should Continue**:
- true если completeness < 0.8 ИЛИ quality < 0.6
- false если completeness >= 0.8 И quality >= 0.6

# ВАЖНО
- Если уже есть 5+ документов и они релевантны → completeness минимум 0.7
- Если есть теория + хотя бы 2 примера → completeness минимум 0.75
- НЕ ставь слишком низкие оценки без причины
- Цель достижима за 3-5 итераций, не затягивай поиск

# Формат ответа (ТОЛЬКО JSON)
{{
  "completeness_score": <0.0-1.0>,
  "relevance_score": <0.0-1.0>,
  "quality_score": <0.0-1.0>,
  "should_continue": <true/false>,
  "reasoning": "<краткое объяснение: что есть, чего не хватает>"
}}"""


HEURISTIC_COMPLETENESS_FORMULA = """
# Эвристическая формула для completeness (fallback)

completeness = min(1.0, (
    0.15 * num_documents +           # Базовая полнота от количества
    0.10 * avg_doc_length / 1000 +   # Учет объема
    0.20 * has_code_examples +       # Наличие кода
    0.15 * has_complexity_analysis + # Анализ сложности
    0.10 * has_diagrams              # Визуализация
))

Минимум для цели: 0.85
"""
