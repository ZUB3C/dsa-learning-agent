graph TB
    subgraph "External Client"
        Client[Client Application]
    end

    subgraph "–ê–∏–°–î Learning Platform v2"
        subgraph "REST API Layer - 20+ endpoints"
            subgraph "System API"
                Health[GET /health<br/>GET /health/detailed<br/>GET /metrics]
            end

            subgraph "Orchestrator Endpoint"
                OrchestratorAPI[POST /api/v1/orchestrator/resolve<br/>–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞]
            end

            subgraph "Direct Agent Endpoints"
                MaterialsAPI[Materials API<br/>5 endpoints]
                TestsAPI[Tests API<br/>4 endpoints]
                VerificationAPI[Verification API<br/>2 endpoints]
                SupportAPI[Support API<br/>2 endpoints]
            end
        end

        subgraph "Core Components"
            Orchestrator[üîó Orchestrator<br/>Intent Detection & Routing<br/>—Å–º. –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ö–µ–º—É]:::external

            Materials[üîó Materials Agent v2<br/>Tree-of-Thoughts + RAG<br/>—Å–º. –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ö–µ–º—É]:::external

            TestGen[Test Generation Agent<br/>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã]

            subgraph "Verification System"
                VerifAgent[Verification Agent<br/>–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞<br/>GigaChat3]
                SecVerif[Secondary Verification<br/>LLM-as-a-Judge<br/>GigaChat-2-Max]
            end

            Support[Support Agent<br/>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞<br/>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫]
        end

        subgraph "RAG System"
            PDFParser[PDF Parser<br/>LaTeX-PDF]
            TextSplitter[Text Splitter<br/>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è]
            VectorStore[ChromaDB<br/>Vector Store]
            Embeddings[HuggingFace<br/>Embeddings]
        end

        subgraph "LLM Layer"
            LLMRouter[LLM Router<br/>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –º–æ–¥–µ–ª—è–º]
            GigaMax[GigaChat-2-Max<br/>–°–ª–æ–∂–Ω—ã–π reasoning]
            Giga3[GigaChat3-10B<br/>–ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏]
        end

        subgraph "Storage"
            DB[(SQLAlchemy)]
            VectorDB[(ChromaDB<br/>–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)]
        end

        subgraph "Monitoring"
            Metrics[DeepEval Metrics<br/>Prometheus]
        end
    end

    %% Client connections
    Client -->|Unified access| OrchestratorAPI
    Client -->|Direct access| MaterialsAPI
    Client -->|Direct access| TestsAPI
    Client -->|Direct access| VerificationAPI
    Client -->|Direct access| SupportAPI
    Client -->|Monitoring| Health

    %% Orchestrator routing
    OrchestratorAPI --> Orchestrator
    Orchestrator -->|Route to| Materials
    Orchestrator -->|Route to| TestGen
    Orchestrator -->|–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ| Support

    %% Direct API to Agents
    MaterialsAPI --> Materials
    TestsAPI --> TestGen
    VerificationAPI --> VerifAgent
    SupportAPI --> Support

    %% Agent interactions
    TestGen --> VerifAgent
    VerifAgent --> SecVerif

    %% RAG System
    Materials --> VectorStore
    PDFParser --> TextSplitter
    TextSplitter --> Embeddings
    Embeddings --> VectorStore

    %% LLM Integration
    Orchestrator -->|–ó–∞–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏| LLMRouter
    TestGen -->|–ó–∞–ø—Ä–æ—Å GigaChat3| LLMRouter
    VerifAgent -->|–ó–∞–ø—Ä–æ—Å GigaChat3| LLMRouter
    SecVerif -->|–ó–∞–ø—Ä–æ—Å GigaChat-2-Max| LLMRouter
    Support -->|–ó–∞–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏| LLMRouter

    LLMRouter -->|–í–æ–∑–≤—Ä–∞—Ç GigaChat-2-Max| GigaMax
    LLMRouter -->|–í–æ–∑–≤—Ä–∞—Ç GigaChat3| Giga3

    %% Storage
    Materials --> DB
    TestGen --> DB
    VerifAgent --> DB
    VectorStore --> VectorDB

    %% Monitoring
    Health --> Metrics
    Materials --> Metrics
    TestGen --> Metrics

    classDef external fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px,color:#000
    classDef apiEndpoint fill:#E6F3FF,stroke:#0066CC,stroke-width:2px

    style Orchestrator fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px
    style Materials fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px
    style Support fill:#E6FFE6,stroke:#00AA00,stroke-width:2px
    style OrchestratorAPI fill:#E6F3FF,stroke:#0066CC,stroke-width:2px
    style MaterialsAPI fill:#F0F0F0,stroke:#666666,stroke-width:1px
    style TestsAPI fill:#F0F0F0,stroke:#666666,stroke-width:1px
    style VerificationAPI fill:#F0F0F0,stroke:#666666,stroke-width:1px
    style SupportAPI fill:#F0F0F0,stroke:#666666,stroke-width:1px
