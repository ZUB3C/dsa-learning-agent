graph TB
    subgraph "Orchestrator API Endpoint"
        APIEndpoint[POST /api/v1/orchestrator/resolve<br/>–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞]
    end

    subgraph "Orchestrator Core"
        subgraph "Classification Layer"
            Classifier[Intent Classifier<br/>LLM-based]
            IntentDetection[Intent Detection<br/>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è]
            SlotFilling[Slot Filling<br/>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤]
        end

        subgraph "Routing Layer"
            Router[Orchestrator Router<br/>–í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞]
        end

        subgraph "Workers Layer"
            ParallelExec[–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ]

            subgraph "Main Workers"
                MaterialsWorker[Materials Worker<br/>‚Üí Materials Agent v2]
                TestWorker[Test Worker<br/>‚Üí Test Generation Agent]
            end

            subgraph "Always Parallel"
                SupportWorker[Support Worker<br/>‚Üí Support Agent<br/>–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞]:::parallel
            end
        end

        subgraph "Execution Layer"
            Executor[Task Executor<br/>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º]
            Aggregator[Result Aggregator<br/>–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
        end
    end

    subgraph "LLM Integration"
        LLMRouter[LLM Router<br/>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –º–æ–¥–µ–ª—è–º]
        GigaChat[GigaChat-2-Max<br/>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è]
    end

    subgraph "Worker Agents"
        MaterialsAgent[üîó Materials Agent v2<br/>—Å–º. –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ö–µ–º—É]:::external
        TestAgent[Test Generation Agent]
        SupportAgent[Support Agent]
    end

    subgraph "Configuration"
        Config[Config Manager<br/>–¢–∞–π–º–∞—É—Ç—ã, –º–æ–¥–µ–ª–∏, —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã]
    end

    APIEndpoint -->|User Query| Classifier

    Classifier --> IntentDetection
    IntentDetection --> SlotFilling
    SlotFilling --> Router

    Classifier -->|–ó–∞–ø—Ä–æ—Å GigaChat-2-Max| LLMRouter
    LLMRouter -->|–í–æ–∑–≤—Ä–∞—Ç –º–æ–¥–µ–ª–∏| GigaChat

    Router --> ParallelExec

    ParallelExec -->|Task Type: materials| MaterialsWorker
    ParallelExec -->|Task Type: test| TestWorker
    ParallelExec -->|–í—Å–µ–≥–¥–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ| SupportWorker

    MaterialsWorker --> Executor
    TestWorker --> Executor
    SupportWorker --> Executor

    Executor -->|Execute| MaterialsAgent
    Executor -->|Execute| TestAgent
    Executor -->|Execute| SupportAgent

    MaterialsAgent -->|Result| Aggregator
    TestAgent -->|Result| Aggregator
    SupportAgent -->|Result| Aggregator

    Aggregator -->|Final Response| APIEndpoint

    Config -.->|Settings| Classifier
    Config -.->|Settings| Executor
    Config -.->|Settings| LLMRouter

    classDef external fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px,color:#000
    classDef parallel fill:#E6FFE6,stroke:#00AA00,stroke-width:2px

    style MaterialsAgent fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px
    style SupportWorker fill:#E6FFE6,stroke:#00AA00,stroke-width:2px
