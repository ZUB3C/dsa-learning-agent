# üìä Materials Agent v2 - Metrics & Evaluation

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ Materials Agent v2 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫ DeepEval.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
material-examples/
‚îú‚îÄ‚îÄ README.md                                         # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ test_topics.json                                  # –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–µ–º—ã (15 —à—Ç.)
‚îî‚îÄ‚îÄ results/                                          # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π
    ‚îú‚îÄ‚îÄ materials_agent_v2_evaluation_results.json    # –ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON
    ‚îú‚îÄ‚îÄ materials_agent_v2_evaluation_report.md       # –û—Ç—á–µ—Ç –≤ Markdown
    ‚îî‚îÄ‚îÄ {topic_id}_result.json                        # –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–µ–º–∞–º
```

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ DeepEval

–°–∫—Ä–∏–ø—Ç –∏–∑–º–µ—Ä—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:

### 1. **Completeness (–ü–æ–ª–Ω–æ—Ç–∞)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–º—É
- **–ú–µ—Ç–æ–¥:** `DeepEvalMetrics.calculate_faithfulness(context, material)`
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0.0 - 1.0
- **–ö—Ä–∏—Ç–µ—Ä–∏–∏:**
  - –ù–∞–ª–∏—á–∏–µ –≤–≤–µ–¥–µ–Ω–∏—è
  - –ü—Ä–∏–º–µ—Ä—ã –∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏
  - –ö–æ–¥ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
  - –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
  - –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
  - –î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–º (>1000 —Å–ª–æ–≤ = 0.7+)

### 2. **Relevance (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Å–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∞–ª —Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–π —Ç–µ–º–µ
- **–ú–µ—Ç–æ–¥:** `DeepEvalMetrics.calculate_answer_relevance(query, material)`
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0.0 - 1.0
- **–ö—Ä–∏—Ç–µ—Ä–∏–∏:**
  - –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
  - Jaccard similarity –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏

### 3. **Quality (–ö–∞—á–µ—Å—Ç–≤–æ)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å–≤—è–∑–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
- **–ú–µ—Ç–æ–¥:** `DeepEvalMetrics.calculate_coherence(material)`
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0.0 - 1.0
- **–ö—Ä–∏—Ç–µ—Ä–∏–∏:**
  - –í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª–∏–Ω—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
  - –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å
  - –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (10-20 —Å–ª–æ–≤)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω

```bash
uv run uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

```bash
uv run python -m src.scripts.measure_materials_agent_v2 \
    --test-data material-examples/test_topics.json \
    --output material-examples/results \
    --base-url http://localhost:8000 \
    --delay 0
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `--test-data`: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–µ–º–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `material-examples/test_topics.json`)
- `--output`: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `material-examples/results`)
- `--base-url`: URL API —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:8000`)
- `--delay`: –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `2.0`)

## üìù –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–µ–º—ã

–§–∞–π–ª `test_topics.json` —Å–æ–¥–µ—Ä–∂–∏—Ç 15 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–µ–º, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:

### Beginner (5 —Ç–µ–º)
1. –õ–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫
2. –°—Ç–µ–∫
3. –û—á–µ—Ä–µ–¥—å
4. –°–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫
5. –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ Big O

### Intermediate (5 —Ç–µ–º)
1. –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫
2. –ë—ã—Å—Ç—Ä–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ QuickSort
3. –•–µ—à-—Ç–∞–±–ª–∏—Ü—ã
4. –î–≤–æ–∏—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø–æ–∏—Å–∫–∞ BST
5. –†–µ–∫—É—Ä—Å–∏—è –∏ –æ–±—Ö–æ–¥ –¥–µ—Ä–µ–≤–∞

### Advanced (5 —Ç–µ–º)
1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –ê–ª–≥–æ—Ä–∏—Ç–º –î–µ–π–∫—Å—Ç—Ä—ã
3. AVL-–¥–µ—Ä–µ–≤—å—è
4. –ê–ª–≥–æ—Ä–∏—Ç–º –ö—Ä–∞—Å–∫–∞–ª–∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–æ–≤–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞
5. –ê–ª–≥–æ—Ä–∏—Ç–º –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä–∏—Å–∞-–ü—Ä–∞—Ç—Ç–∞ KMP

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞

### JSON Results (`materials_agent_v2_evaluation_results.json`)

–ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "test_suite": "materials_agent_v2_evaluation",
  "base_url": "http://localhost:8000",
  "overall_metrics": {
    "total_tests": 15,
    "successful_tests": 15,
    "success_rate": 100.0,
    "avg_completeness": 0.850,
    "avg_relevance": 0.920,
    "avg_quality": 0.880,
    "total_cost_usd": 0.0450,
    "breakdown_by_level": {
      "beginner": {...},
      "intermediate": {...},
      "advanced": {...}
    }
  },
  "individual_results": [...]
}
```

### Markdown Report (`materials_agent_v2_evaluation_report.md`)

–ß–∏—Ç–∞–µ–º—ã–π –æ—Ç—á–µ—Ç —Å:
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (success rate, –º–µ—Ç—Ä–∏–∫–∏)
- DeepEval –º–µ—Ç—Ä–∏–∫–∏ (—Å—Ä–µ–¥–Ω–∏–µ, min, max)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤—Ä–µ–º—è, –∏—Ç–µ—Ä–∞—Ü–∏–∏ ToT, –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- –°—Ç–æ–∏–º–æ—Å—Ç—å (–æ–±—â–∞—è, —Å—Ä–µ–¥–Ω—è—è, LLM –≤—ã–∑–æ–≤—ã)
- Breakdown –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)

### Individual Results (`{topic_id}_result.json`)

–î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π JSON —Ñ–∞–π–ª —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- ToT –º–µ—Ç—Ä–∏–∫–∏ (–∏—Ç–µ—Ä–∞—Ü–∏–∏, —É–∑–ª—ã)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Generation ID –¥–ª—è —Å–≤—è–∑–∏ —Å API

## üìà –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ç–ª–∏—á–Ω–æ | –•–æ—Ä–æ—à–æ | –ü—Ä–∏–µ–º–ª–µ–º–æ | –ü–ª–æ—Ö–æ |
|---------|---------|--------|-----------|-------|
| **Completeness** | ‚â• 0.85 | 0.70-0.84 | 0.50-0.69 | < 0.50 |
| **Relevance** | ‚â• 0.90 | 0.75-0.89 | 0.60-0.74 | < 0.60 |
| **Quality** | ‚â• 0.85 | 0.70-0.84 | 0.50-0.69 | < 0.50 |

### Success Rate
- **100%**: –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- **90-99%**: –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ–¥–∏–Ω–∏—á–Ω—ã–µ —Å–±–æ–∏
- **80-89%**: –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –Ω–µ—É–¥–∞—á
- **< 80%**: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### Breakdown –ø–æ —É—Ä–æ–≤–Ω—è–º

–û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º:
- **Beginner**: –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–µ Completeness –∏ Quality (–ø—Ä–æ—Å—Ç—ã–µ —Ç–µ–º—ã)
- **Intermediate**: –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **Advanced**: –í–æ–∑–º–æ–∂–Ω–æ –Ω–∏–∂–µ Completeness (—Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

## üîç –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤
```bash
# –°–º–æ—Ç—Ä–∏–º –æ—Ç—á–µ—Ç
cat material-examples/results/materials_agent_v2_evaluation_report.md | grep "Successful"
```

### 2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É beginner/intermediate/advanced:
- –ë–æ–ª—å—à–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π —É—Ä–æ–≤–Ω—è
- –ù–∏–∑–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ beginner - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏
- –ù–∏–∑–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ advanced - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–ª—É–±–∏–Ω—ã

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Generation Time**: –¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è < 60s –Ω–∞ —Ç–µ—Å—Ç
- **ToT Iterations**: –°—Ä–µ–¥–Ω–µ–µ 5-7 –∏—Ç–µ—Ä–∞—Ü–∏–π
- **Cost**: < $0.005 –Ω–∞ —Ç–µ—Å—Ç

### 4. –ò–∑—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
–ù–∞–π–¥–∏—Ç–µ —Ç–µ–º—ã —Å –Ω–∏–∑–∫–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ:
- –ö–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å?
- –°–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—ã–ª–æ —Å–æ–±—Ä–∞–Ω–æ?
- –ë—ã–ª–∏ –ª–∏ warnings –∏–ª–∏ fallbacks?

## üõ†Ô∏è Troubleshooting

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```
‚ùå API error 503: http://localhost:8000/api/v2/materials/generate
```
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω: `uv run uvicorn src.main:app --reload`
